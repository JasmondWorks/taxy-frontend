import { coloredCardString } from "./colored-card.js";
import { dropdownHtmlString } from "./dropdown.js";

export const businessFormsHtmlString = ({
  grossAnnualIncome,
  businessType,
  sellsVatSellableGoods,
  isMultiNational,
  fixedAssets,
  profit,
} = {}) => {
  // Helper to safely format value for input
  const safeVal = (val) => {
    if (val === undefined || val === null || val === 0) return "";
    return Number(val).toLocaleString("en-US");
  };

  const isSelected = (val, target) => {
    // Handle boolean or string comparisons
    if (typeof val === "boolean") {
      return val === (target === "true") ? "checked" : "";
    }
    return val === target ? "checked" : "";
  };

  const isOptionSelected = (val, target) => {
    return val === target ? "selected" : "";
  };

  return `
    <div class="">
      <div class="steps__content" data-target="step-3">
        <div class="flow">
          <p class="text-muted"><small>QUESTION 3 OF 4</small></p>
          <h1 class="heading-primary">How much do you earn?</h1>
          <p class="text-muted">
            Select your annual income range to get personalized tax guidance
          </p>
        </div>
        <div class="earning-layout-container">
          <div>
            <form class="earning-forms">
              <div>
                <p class="form-title">
                  <small>BASIC INFORMATION</small>
                </p>
                <div class="form-container">
                  <div class="basic-info-form">
                    <div class="naira-input-field required">
                      <div class="input-label-container">
                        <label for="gross-income"
                          >Gross annual turnover (₦)
                        </label>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                            The total annual revenue generated by your business before any deductions.
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper">
                        <input
                          required
                          type="text"
                          inputmode="decimal"
                          class="currency-input"
                          id="gross-annual-income"
                          placeholder="0.00"
                          value="${safeVal(grossAnnualIncome)}"
                        />
                      </div>
                    </div>
                    <div class="required">
                      <div class="input-label-container">
                        <label for="gross-income">Business type </label>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                            Select 'Professional' for services like Law, Accounting, or Consulting. Select 'Normal' for others.
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper">
                        <select required name="business-type" id="business-type">
                          <option value="">Select business type</option>
                          <option value="normal" ${isOptionSelected(businessType, "normal")}>Normal</option>
                          <option value="professional" ${isOptionSelected(businessType, "professional")}>Professional (Services)</option>
                        </select>
                      </div>
                    </div>
                    <div class="required">
                      <div class="input-label-container">
                        <div>Sells VATable goods?</div>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                           Does your business sell goods or services that are subject to Value Added Tax?
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper radio-inputs-wrapper">
                        <label for="vat-yes">
                          <input
                            required
                            type="radio"
                            name="sells-vat-goods"
                            id="vat-yes"
                            value="true"
                            ${isSelected(sellsVatSellableGoods, "true")}
                          />
                          Yes
                        </label>
                        <label for="vat-no">
                          <input
                            required
                            type="radio"
                            name="sells-vat-goods"
                            id="vat-no"
                            value="false"
                            ${isSelected(sellsVatSellableGoods, "false")}
                          />
                          No
                        </label>
                      </div>
                    </div>
                    <div class="required">
                      <div class="input-label-container">
                        <div for="gross-income">
                          Is your business multi-national?
                        </div>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                            Select 'Yes' if your company operates in multiple countries.
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper radio-inputs-wrapper">
                        <label for="multi-national-yes">
                          <input
                            required
                            type="radio"
                            name="multi-national"
                            id="multi-national-yes"
                            value="true"
                            ${isSelected(isMultiNational, "true")}
                          />
                          Yes
                        </label>
                        <label for="multi-national-no">
                          <input
                            required
                            type="radio"
                            name="multi-national"
                            id="multi-national-no"
                            value="false"
                             ${isSelected(isMultiNational, "false")}
                          />
                          No
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <p class="form-title">
                  <small>ADDITIONAL INFORMATION (OPTIONAL)</small>
                </p>
                <div class="form-container">
                  <div class="additional-info-form">
                    <div class="naira-input-field">
                      <div class="input-label-container">
                        <label for="fixed-assets">Fixed Assets (₦) </label>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                            <p>
                             Total value of long-term assets like property, plant, and equipment.
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper">
                        <input
                          type="text"
                          inputmode="decimal"
                          class="currency-input"
                          id="fixed-assets"
                          placeholder="0.00"
                          value="${safeVal(fixedAssets)}"
                        />
                      </div>
                    </div>
                    <div class="naira-input-field">
                      <div class="input-label-container">
                        <label for="profit">Profit </label>
                        <div class="dropdown">
                          <button class="dropdown__trigger" type="button">
                            <i class="ri-information-line text-muted"></i>
                          </button>
                          <div class="dropdown__content">
                            <p>
                              Net profit before tax.
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="input-wrapper">
                        <input
                          type="text"
                          inputmode="decimal"
                          class="currency-input"
                          id="profit"
                          placeholder="0.00"
                          value="${safeVal(profit)}"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="buttons-container">
                <button type="button" class="btn btn--outline previous-button">
                  <i class="ri-arrow-left-long-line"></i> Back
                </button>
                <button
                  type="button"
                  class="btn btn--primary btn--wide submit-button"
                >
                  Calculate tax <i class="ri-arrow-right-long-line"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>`;
};
